
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adger</title>
    <link rel="icon" href="logo.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">

    <!-- بيانات Open Graph -->
    <meta property="og:title" content="Adger - التسوق الإلكتروني">
    <meta property="og:description" content="مرحبًا بك في أدجر، وجهتك الأولى للتسوق الإلكتروني حيث تجد كل ما تبحث عنه بأسعار تنافسية وجودة عالية.">
    <meta property="og:image" content="https://i.postimg.cc/bYk5FR3Q/2024-10-24-13-27-28-da2d3af5.jpg">
    <meta property="og:url" content="https://adger-saifeddine.github.io/adger/">
    <meta property="og:type" content="website">

    <!-- بيانات منظمة Schema.org -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Adger",
      "url": "https://adger-saifeddine.github.io/adger/",
      "logo": "https://i.postimg.cc/bYk5FR3Q/2024-10-24-13-27-28-da2d3af5.jpg"
    }
    </script>

    <!-- نص برمجي لتغيير الفيكون بناءً على نوع الجهاز -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        function isDesktop() {
            var userAgent = navigator.userAgent.toLowerCase();
            return userAgent.includes('windows') || userAgent.includes('macintosh') || userAgent.includes('linux') && !userAgent.includes('android');
        }
        if (isDesktop()) {
            document.querySelector('link[rel="icon"]').href = 'logo2.png';
        }
    });
    </script>
</head>
<body>
    <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحة البحث</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link id="fontLink" href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: white;
            margin: 0;
            padding: 0;
            font-family: "Tajawal", sans-serif;
            padding-top: 25px; 
        }
        @media (max-width: 499px) {
            body {
                font-family: Arial, sans-serif !important;
            }
        }
        @media (max-width: 999px) {
            body {
                font-family: Arial, sans-serif !important;
            }
        }

        @keyframes aurora {
            0% {
                background-position: 50% 0%, 0% 50%, 100% 50%;
            }
            50% {
                background-position: 50% 100%, 100% 0%, 0% 100%;
            }
            100% {
                background-position: 50% 0%, 0% 50%, 100% 50%;
            }
        }

        .header-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 65px;
            background-color: white;
            z-index: 1;
            text-shadow: none;
        }

        .search-container {
            position: fixed;
            top: 10px;
            left: 20px;
            right: 60px;
            width: calc(100% - 80px);
            direction: rtl;
            z-index: 2;
            background-color: transparent;
            max-width: none;
        }

        .search-container input[type="text"] {
            width: 100%;
            padding: 10px 12px 10px 108px;
            font-size: 16px;
            border: 1px solid #000000;
            border-radius: 51px;
            outline: none;
            box-sizing: border-box;
            text-align: right;
            direction: rtl;
            transition: border-color 0.3s;
        }

        @media (max-width: 499px) {
            .search-container {
                right: 40px;
                width: calc(100% - 60px);
            }
            .search-container input[type="text"] {
                width: 100%;
                margin-right: 0;
            }
        }

        .search-container .search-button {
            position: absolute;
            left: 3px;
            top: 50%;
            transform: translateY(-50%);
            background-color: black;
            color: white;
            width: 73px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 33px;
            border: none;
            cursor: pointer;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        @media (max-width: 768px) {
            .search-container .search-button {
                width: 50px;
            }
        }

        .search-container .search-button:hover {
            background-color: #333;
        }

        .search-container .search-button svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .search-container .clear-button {
            position: absolute;
            left: 80px;
            top: 54%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            display: none;
            color: #000000;
        }

        @media (max-width: 768px) {
            .search-container .clear-button {
                left: 55px;
            }
        }

        .search-container .clear-button:hover {
            color: #000000;
        }

        .search-container .clear-button svg {
            width: 20px;
            height: 20px;
        }

        .back-button {
            position: fixed;
            top: 10px;
            right: 11px;
            background-color: transparent;
            color: black;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 3;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        @media (max-width: 499px) {
            .back-button {
                right: 2px;
            }
        }

        .back-button svg {
            width: 20px;
            height: 20px;
        }

        .search-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin-top: 20px;
        }

        .search-history-header h2 {
            margin: 0;
            font-size: 18px;
            font-family: 'Cairo', sans-serif;
        }
        @media (max-width: 555px) {
            .search-history-header h2 {
                font-size: 15px;
            }
        }

        .search-history-header .delete-all-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            height: 24px;
            width: 24px;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }
        @media (max-width: 555px) {
            .search-history-header .delete-all-button {
                height: 20px;
                width: 20px;
            }
        }

        .search-history-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 20px;
        }
        
        .empty-history-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            color: #a0a0a0;
            padding: 15px 0;
            text-align: center;
        }
        .empty-history-container svg {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            fill: #d0d0d0;
        }
        .empty-history-container span {
            font-size: 16px;
            font-weight: 500;
        }
        @media (max-width: 555px) {
            .empty-history-container svg {
                width: 32px;
                height: 32px;
            }
            .empty-history-container span {
                font-size: 14px;
            }
        }


        .search-item {
            background-color: #f0f0f0;
            border-radius: 16px;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            max-width: 300px;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }
        @media (max-width: 555px) {
            .search-item {
                padding: 6px 11px;
            }
        }

        .search-item:hover {
            background-color: #f3f3f3;
        }

        .search-item span {
            font-size: 16px;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-item small {
            font-size: 12px;
            color: #888;
            flex: 0 0 auto;
            min-width: 60px;
            text-align: left;
            margin-left: 10px;
        }

        .search-item .delete-button {
            background: none;
            border: none;
            cursor: pointer;
            color: #585858;
            font-size: 13px;
            padding: 0;
            flex: 0 0 auto;
            margin-left: 5px;
        }

        .delete-button:hover {
            color: #000000;
        }

        @media (max-width: 499px) {
            .search-item .delete-button {
                display: none !important;
            }
        }
        
        .last-search-item {
            background-color: #0077ff1c;
            border-radius: 16px;
            padding: 9px 15px;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 10px;
            margin: 1px 40px 0 20px;
            max-width: 300px;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }
        @media (max-width: 555px) {
            .last-search-item {
                padding: 5px 11px;
                margin-top: -3px;
                margin-right: 30px;
            }
        }

        .last-search-item:hover {
            background-color: #00aeff18;
        }

        .last-search-item span {
            font-size: 16px;
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 15px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
            background-color: #0d1a42;
            background-image: 
                radial-gradient(ellipse at 50% 0%, rgba(28, 119, 219, 0.5) 0%, transparent 80%),
                radial-gradient(ellipse at 0% 50%, rgba(138, 43, 226, 0.4) 0%, transparent 70%),
                radial-gradient(ellipse at 100% 50%, rgba(0, 255, 255, 0.4) 0%, transparent 70%);
            background-repeat: no-repeat;
            background-size: 200% 200%;
            animation: aurora 20s linear infinite;
        }

        .image-item {
            display: flex;
            align-items: center;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            background-color: #ffffff;
            padding: 12px;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        .image-item img {
            width: 120px;
            max-height: 120px;
            object-fit: cover;
            border-radius: 12px;
        }

        .image-item span {
            font-size: 18px;
            color: #333;
            font-weight: 600;
            margin-right: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
            font-family: 'Cairo', sans-serif;
        }

        .image-item:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 767px) {
            .image-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
            .image-item { padding: 8px; }
            .image-item img { width: 80px; max-height: 80px; }
            .image-item span { font-size: 14px; margin-right: 6px; max-width: 110px; }
            .search-item small { display: none; }
        }

        @media (max-width: 499px) {
            .image-grid { gap: 10px; padding: 10px; }
            .image-item { padding: 6px; }
            .image-item img { width: 80px; max-height: 80px; }
            .image-item span { font-size: 10px; margin-right: 4px; max-width: 120px; }
        }

        @media (min-width: 768px) and (max-width: 1500px) {
            .image-grid { grid-template-columns: repeat(3, 1fr); }
            .image-item img { width: 100px; max-height: 100px; }
            .image-item span { font-size: 16px; max-width: 120px; }
        }

        @media (min-width: 1201px) and (max-width: 1800px) {
            .image-grid { grid-template-columns: repeat(4, 1fr); }
            .image-item img { width: 100px; max-height: 100px; }
            .image-item span { font-size: 16px; max-width: 120px; }
        }

        @media (min-width: 2001px) {
            .image-grid { grid-template-columns: repeat(6, 1fr); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        #confirm-yes { background-color: #ff0000; color: white; }
        #confirm-no { background-color: #ccc; color: black; }

        .discover-more-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin-top: -20px;
            margin-bottom: -18px;
        }
        @media (max-width: 555px) {
            .discover-more-header { margin-top: -20px; margin-bottom: -24px; }
        }

        .discover-more-header h2 {
            margin: 0;
            font-size: 18px;
            font-family: 'Cairo', sans-serif;
        }
        @media (max-width: 555px) {
            .discover-more-header h2 { font-size: 15px; }
        }

        .discover-more-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 20px;
        }

        .discover-item {
            background-color: #f0f0f0;
            border-radius: 16px;
            padding: 10px 15px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }
        @media (max-width: 555px) {
            .discover-item { padding: 6px 11px; margin-top: 1px; }
        }

        .discover-item:hover { background-color: #f3f3f3; }
        .discover-item span { font-size: 16px; flex-grow: 1; }
        .search-item-with-arrow { display: inline-flex; align-items: center; gap: 10px; }

        #show-more-arrow {
            background-color: #ebebeb;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            padding: 4px 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        @media (max-width: 555px) { #show-more-arrow { padding: 4px 5px; } }
        #show-more-arrow:hover { background-color: #d0d0d0b4; }
        #show-more-arrow svg { width: 24px; height: 24px; }
        @media (max-width: 555px) { #show-more-arrow svg { width: 21px; height: 21px; } }
        
        .fab {
            position: fixed;
            bottom: 25px;
            left: 25px; 
            width: 56px;
            height: 56px;
            background-color: #000000;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 999;
            transition: transform 0.2s, bottom 0.2s ease-out;
            -webkit-tap-highlight-color: transparent;
        }
        .fab:hover { transform: scale(1.05); }
        .fab svg { width: 24px; height: 24px; }
        
        @media (max-width: 767px) {
            .fab {
                width: 48px;
                height: 48px;
                bottom: 20px;
                left: 20px;
            }
            .fab svg {
                width: 20px;
                height: 20px;
            }
        }
        
        .notes-modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: right;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            box-sizing: border-box;
        }
        .notes-modal-content h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-family: 'Cairo', sans-serif;
            color: #333;
        }
        .notes-modal-content textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-family: 'Tajawal', sans-serif;
            font-size: 16px;
            resize: vertical;
            box-sizing: border-box;
            margin-bottom: 15px;
        }
        .notes-modal-content .modal-buttons button {
            background-color: #000000;
            color: white;
        }
        .notes-modal-content .modal-buttons button.cancel {
            background-color: #ccc;
            color: black;
        }
    </style>
</head>
<body>
    <div class="header-background"></div>
    <button class="back-button" id="back-button">
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 5 7 7-7 7"/>
        </svg>          
    </button>

    <div id="confirmation-modal" class="modal">
        <div class="modal-content">
            <p>هل أنت متأكد أنك تريد حذف الكل؟</p>
            <div class="modal-buttons">
                <button id="confirm-yes">نعم</button>
                <button id="confirm-no">لا</button>
            </div>
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="ابحث هنا" autocomplete="off" autofocus inputmode="search">
        <button class="clear-button" id="clear-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <button class="search-button" id="search-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <circle cx="10" cy="10" r="7" fill="none" stroke="white" stroke-width="2" />
                <path d="M15 15l4 4" stroke="white" stroke-width="2" />
            </svg>
        </button>
    </div>

    <div class="search-history-header" id="search-history-header">
        <h2>بحث المحفوظات</h2>
        <button class="delete-all-button" id="delete-all-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="#ff0000" stroke-width="2" fill="none"/>
                <path d="M10 11v6" stroke="#ff0000" stroke-width="2" stroke-linecap="round"/>
                <path d="M14 11v6" stroke="#ff0000" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
    </div>

    <div class="last-search-item" id="last-search-item">
        <span id="last-search-term"></span>
    </div>

    <div class="search-history-grid" id="search-history"></div>

    <div class="discover-more-header">
        <h2>استكشف المزيد</h2>
    </div>
    <div class="discover-more-grid" id="discover-more">
        <div class="discover-item" onclick="executeSearch('كتاب ابقَ قويًا 365 يومًا في السنة')"><span>كتاب ابقَ قويًا 365 يومًا في السنة</span></div>
        <div class="discover-item" onclick="executeSearch('حذاء جلد - p30 سكاي مريح')"><span>حذاء جلد - p30 سكاي مريح</span></div>
        <div class="discover-item" onclick="executeSearch('مج حراري فاخر 500 مل مع كوبين')"><span>مج حراري فاخر 500 مل مع كوبين</span></div>
        <div class="discover-item" onclick="executeSearch('ايربودز A-16 بلوتوث')"><span>ايربودز A-16 بلوتوث</span></div>
        <div class="discover-item" onclick="executeSearch('طابعة USB')"><span>طابعة USB</span></div>
    </div>

    <div class="image-grid" id="image-grid">
        <div class="image-item" data-term="إلكترونيات"><img src="https://i.postimg.cc/MpjL8zcT/2025-04-05-09-45-39-ed15ed17.jpg" alt="إلكترونيات"><span>إلكترونيات</span></div>
        <div class="image-item" data-term="كمبيوتر"><img src="https://i.postimg.cc/FzRPCv5h/2025-04-05-09-45-39-39aedaee.jpg" alt="كمبيوتر"><span>كمبيوتر</span></div>
        <div class="image-item" data-term="سماعات"><img src="https://i.postimg.cc/sf6HQM7x/2025-04-05-09-45-39-2be9783b.jpg" alt="سماعات"><span>سماعات</span></div>
        <div class="image-item" data-term="كتب"><img src="https://i.postimg.cc/wvxF3zBD/2025-04-05-09-45-39-5deb6b6f.jpg" alt="كتب"><span>كتب</span></div>
        <div class="image-item" data-term="ألعاب"><img src="https://i.postimg.cc/Y0Qpgh25/2025-04-10-07-24-51-b2ba5d7c.jpg" alt="ألعاب"><span>ألعاب</span></div>
        <div class="image-item" data-term="كاميرات"><img src="https://i.postimg.cc/vBRknX1m/2025-04-10-07-24-45-facc6757.jpg" alt="كاميرات"><span>كاميرات</span></div>
        <div class="image-item" data-term="ملابس"><img src="https://i.postimg.cc/TYbjd1cZ/2025-04-05-09-45-40-41d5fc86.jpg" alt="ملابس"><span>ملابس</span></div>
        <div class="image-item" data-term="أحذية"><img src="https://i.postimg.cc/zGZzJw7q/2025-04-10-07-24-37-93a3f62f.jpg" alt="أحذية"><span>أحذية</span></div>
        <div class="image-item" data-term="أثري"><img src="https://i.postimg.cc/Qdkp7zwm/2025-04-05-09-45-40-48ae9eca.jpg" alt="أثري"><span>أثري</span></div>
        <div class="image-item" data-term="ساعات"><img src="https://i.postimg.cc/PqX1Q4kj/2025-04-05-09-45-41-8295ff26.jpg" alt="ساعات"><span>ساعات</span></div>
        <div class="image-item" data-term="إكسسوارات"><img src="https://i.postimg.cc/9fLZ87Wq/2025-04-05-09-45-41-41001644.jpg" alt="إكسسوارات"><span>إكسسوارات</span></div>
        <div class="image-item" data-term="فن"><img src="https://i.postimg.cc/WzXBtSj1/2025-04-05-09-45-42-b7e6d1c8.jpg" alt="فن"><span>فن</span></div>
    </div>

    <div class="fab" id="fab-button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32l8.4-8.4z" /><path d="M5.25 5.25a3 3 0 00-3 3v10.5a3 3 0 003 3h10.5a3 3 0 003-3V13.5a.75.75 0 00-1.5 0v5.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5V8.25a1.5 1.5 0 011.5-1.5h5.25a.75.75 0 000-1.5H5.25z" /></svg>
    </div>

    <div id="notes-modal" class="modal">
        <div class="notes-modal-content">
            <h3>ملاحظات سريعة</h3>
            <textarea id="notes-textarea" placeholder="اكتب ملاحظاتك هنا..."></textarea>
            <div class="modal-buttons">
                <button id="save-notes-button">حفظ</button>
                <button id="close-notes-button" class="cancel">إغلاق</button>
            </div>
        </div>
    </div>
    
    <script>
        // --- Element Constants ---
        const deleteAllButton = document.getElementById('delete-all-button');
        const modal = document.getElementById('confirmation-modal');
        const confirmYes = document.getElementById('confirm-yes');
        const confirmNo = document.getElementById('confirm-no');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const backButton = document.getElementById('back-button');
        const searchHistoryGrid = document.getElementById('search-history');
        const searchHistoryHeader = document.getElementById('search-history-header');
        const imageGrid = document.getElementById('image-grid');
        const clearButton = document.getElementById('clear-button');
        const lastSearchItem = document.getElementById('last-search-item');
        const lastSearchTerm = document.getElementById('last-search-term');
        const fabButton = document.getElementById('fab-button');
        const notesModal = document.getElementById('notes-modal');
        const closeNotesButton = document.getElementById('close-notes-button');
        const saveNotesButton = document.getElementById('save-notes-button');
        const notesTextarea = document.getElementById('notes-textarea');
        
        let isAllHistoryShown = false;
        
        // --- Modal Event Listeners ---
        deleteAllButton.addEventListener('click', () => {
            const searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
            if (searchHistory.length > 0) modal.style.display = 'flex';
        });
        confirmYes.addEventListener('click', () => {
            localStorage.removeItem('searchHistory');
            isAllHistoryShown = false;
            initializePage(); // Re-render the page state
            modal.style.display = 'none';
        });
        confirmNo.addEventListener('click', () => {
            modal.style.display = 'none';
        });
        fabButton.addEventListener('click', () => {
            notesTextarea.value = localStorage.getItem('quickNotes') || '';
            notesModal.style.display = 'flex';
        });
        closeNotesButton.addEventListener('click', () => {
            notesModal.style.display = 'none';
        });
        saveNotesButton.addEventListener('click', () => {
            localStorage.setItem('quickNotes', notesTextarea.value);
            notesModal.style.display = 'none';
        });
        window.addEventListener('click', (event) => {
            if (event.target === modal || event.target === notesModal) {
                modal.style.display = 'none';
                notesModal.style.display = 'none';
            }
        });
        
        // --- Core Search Functionality ---
        backButton.addEventListener('click', () => window.history.back());
        
        const searchTexts = ["ابحث هنا", "اكتشف العروض الجديدة", "تصفح الفئات", "ابحث عن العلامات التجارية", "ابحث عن الكلمات الرئيسية"];
        let currentTextIndex = 0;
        setInterval(() => {
            currentTextIndex = (currentTextIndex + 1) % searchTexts.length;
            if (document.activeElement !== searchInput) {
                 searchInput.placeholder = searchTexts[currentTextIndex];
            }
        }, 5000);
        
        function executeSearch(searchTerm) {
            const term = searchTerm.trim();
            if (term && term !== "ابحث هنا") {
                saveSearchTerm(term);
                saveLastSearchTerm(term);
                window.location.href = `adger.search.html?search=${encodeURIComponent(term)}`;
            }
        }
        
        searchButton.addEventListener('click', () => executeSearch(searchInput.value || searchTexts[currentTextIndex]));
        searchInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') executeSearch(searchInput.value);
        });
        searchInput.addEventListener('input', () => {
            clearButton.style.display = searchInput.value.trim() !== '' ? 'block' : 'none';
        });
        clearButton.addEventListener('click', () => {
            searchInput.value = '';
            clearButton.style.display = 'none';
            searchInput.focus();
        });
        
        // --- History and Term Management ---
        function saveSearchTerm(term) {
            let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
            searchHistory = searchHistory.filter(entry => entry.term !== term); // Remove duplicates
            const date = new Date().toLocaleDateString('ar-EG');
            searchHistory.unshift({ term, date });
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
        }
        
        function saveLastSearchTerm(term) {
            localStorage.setItem('lastSearchTerm', term);
        }
        
        function displayLastSearchTerm() {
            const lastTerm = localStorage.getItem('lastSearchTerm');
            if (lastTerm) {
                const displayTerm = (lastTerm.length > 26) ? lastTerm.slice(0, 26) + '...' : lastTerm;
                lastSearchTerm.textContent = displayTerm;
                lastSearchItem.style.display = 'inline-flex';
            } else {
                lastSearchItem.style.display = 'none';
            }
        }
        
        function displaySearchHistory() {
            const searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
            searchHistoryGrid.innerHTML = '';
            
            searchHistoryHeader.style.display = 'flex';
        
            if (searchHistory.length === 0) {
                searchHistoryGrid.innerHTML = `<div class="empty-history-container">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6a7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7v2a9 9 0 0 0 9-9 9 9 0 0 0-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"></path></svg>
                    <span>سجل البحث فارغ</span>
                </div>`;
                return;
            }
        
            const maxItems = window.matchMedia("(max-width: 1522px)").matches ? 12 : 22;
            const itemsToShow = (isAllHistoryShown || searchHistory.length <= maxItems) ? searchHistory : searchHistory.slice(0, maxItems);

            itemsToShow.forEach((entry, index) => {
                const searchItem = document.createElement('div');
                searchItem.className = 'search-item';
                const displayTerm = (entry.term.length > 26) ? entry.term.slice(0, 26) + '...' : entry.term;
                searchItem.innerHTML = `<span>${displayTerm}</span><small>${entry.date}</small><button class="delete-button">✖</button>`;

                searchItem.addEventListener('click', (e) => {
                    if (e.target.className !== 'delete-button') executeSearch(entry.term);
                });
                searchItem.querySelector('.delete-button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeSearchTermFromHistory(entry.term);
                });

                if (!isAllHistoryShown && searchHistory.length > maxItems && index === maxItems - 1) {
                    const itemWithArrow = document.createElement('div');
                    itemWithArrow.className = 'search-item-with-arrow';
                    itemWithArrow.appendChild(searchItem);
                    const arrow = document.createElement('div');
                    arrow.id = 'show-more-arrow';
                    arrow.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6" /></svg>`;
                    arrow.addEventListener('click', (e) => {
                        e.stopPropagation();
                        isAllHistoryShown = true;
                        displaySearchHistory();
                    });
                    itemWithArrow.appendChild(arrow);
                    searchHistoryGrid.appendChild(itemWithArrow);
                } else {
                    searchHistoryGrid.appendChild(searchItem);
                }
            });
        }
        
        function removeSearchTermFromHistory(term) {
            let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
            const updatedHistory = searchHistory.filter(entry => entry.term !== term);
            localStorage.setItem('searchHistory', JSON.stringify(updatedHistory));
            displaySearchHistory();
        }
        
        lastSearchItem.addEventListener('click', () => {
            const lastTerm = localStorage.getItem('lastSearchTerm');
            if (lastTerm) {
                searchInput.value = lastTerm + ' ';
                searchInput.focus();
                clearButton.style.display = 'block';
            }
        });
        
        imageGrid.addEventListener('click', (event) => {
            const imageItem = event.target.closest('.image-item');
            if (imageItem) executeSearch(imageItem.getAttribute('data-term'));
        });
        
        // --- Initial Load and Resizing ---
        function initializePage() {
            displaySearchHistory();
            displayLastSearchTerm();
        }
        
        function redirectToSea(categoryName) {
            executeSearch(categoryName);
        }

        window.addEventListener('load', () => {
            setTimeout(() => {
                searchInput.focus();
                searchInput.click();
            }, 500);
            initializePage();
        });
        
        window.addEventListener('resize', initializePage);

        // --- CORRECTED: FAB behavior to appear above virtual keyboard ---
        if (fabButton && 'visualViewport' in window) {
            // --- FIX: Store the initial bottom value ONCE, outside the event listener ---
            const initialFabBottomValue = parseFloat(window.getComputedStyle(fabButton).bottom);

            const adjustFabForKeyboard = () => {
                const viewport = window.visualViewport;
                // Calculate the space taken by the keyboard
                const keyboardHeight = window.innerHeight - viewport.height;
                // A threshold to avoid reacting to browser UI changes (like address bar hiding)
                const keyboardThreshold = 100;

                if (keyboardHeight > keyboardThreshold) {
                    // Keyboard is open. The new bottom position is the keyboard's height
                    // plus the original margin we want to maintain.
                    fabButton.style.bottom = `${keyboardHeight + initialFabBottomValue}px`;
                } else {
                    // Keyboard is closed. Reset the button to its original stored value.
                    fabButton.style.bottom = `${initialFabBottomValue}px`;
                }
            };
            
            // Add the listener to the visualViewport's resize event
            window.visualViewport.addEventListener('resize', adjustFabForKeyboard);
        }
        
    </script>
</body>
</html>